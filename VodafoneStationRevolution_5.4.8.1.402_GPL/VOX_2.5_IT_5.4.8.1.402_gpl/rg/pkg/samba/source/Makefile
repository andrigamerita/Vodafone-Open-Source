SMBDIR=.
include $(SMBDIR)/envir.mak

JMK_FIRST_TASKS=dynconfig.o
JMK_O_OBJS_dynconfig.o=dynconfig.o
JMK_CFLAGS_dynconfig.o=$(DEFINES) -DSHLIBEXT=\"so\"
JMK_CLEAN+=dynconfig.o

JMK_SUBDIRS=lib libsmb locking param passdb printing profile librpc rpc_client \
  rpc_parse rpc_server tdb popt auth registry libads modules services
JMK_SUBDIRS+=$(if $(CONFIG_RG_FILESERVER),nmbd smbd)
JMK_SUBDIRS+=$(if $(CONFIG_RG_SAMBA_CLIENT),client)

AUTOGENERATED_FILES=include/stamp-h smbd/build_options.c

AWK=awk

include $(SMBMK)

archconfig:: $(AUTOGENERATED_FILES)

include/stamp-h:
	date >$@

smbd/build_options.c: include/config.h.in script/mkbuildoptions.awk
	@echo Generating $@
	@dir=smbd && $(AWK) -f script/mkbuildoptions.awk > $@ < include/config.h.in

